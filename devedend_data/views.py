from django.shortcuts import render
from bs4 import BeautifulSoup
from urllib.request import Request, urlopen
import pandas as pd
import requests
import re
#from devedend_data.models import data

# Create your views here.
#Home page
data = {'Nestle': ['Nestle', 'Final', '650.00', '16-02-2021', '-', '29-04-2021', 65.0, 0.40385212799005904], 'Castrol': ['Castrol', 'Final', '60.00', '01-02-2021', '-', '22-04-2021', 3.0, 2.34375], 'ABB India': ['ABB India', 'Final', '250.00', '10-02-2021', '-', '19-04-2021', 5.0, 0.328515111695138], 'Schaeffler Ind': ['Schaeffler Ind', 'Final', '380.00', '16-02-2021', '-', '19-04-2021', 38.0, 0.7331661200077175], 'Sanofi India': ['Sanofi India', 'Special', '2400.00', '24-02-2021', '-', '19-04-2021', 240.0, 2.956757422693113], 'ACC': ['ACC', 'Final', '140.00', '11-02-2021', '31-03-2021', '30-03-2021', 14.0, 0.7662835249042146], 'CRISIL': ['CRISIL', 'Final', '1400.00', '11-02-2021', '-', '30-03-2021', 14.0, 0.7223942208462333], 'Coal India': ['Coal India', 'Interim', '0.00', '23-02-2021', '16-03-2021', '15-03-2021', 0.0, 0.0], 'DIC India': ['DIC India', 'Final', '60.00', '03-02-2021', '12-03-2021', '10-03-2021', 6.0, 1.4814814814814814], 'Marico': ['Marico', 'Interim', '0.00', '17-02-2021', '12-03-2021', '10-03-2021', 0.0, 0.0], 'Power Grid Corp': ['Power Grid Corp', 'Interim', '0.00', '23-02-2021', '09-03-2021', '08-03-2021', 0.0, 0.0], 'Hindustan Aeron': ['Hindustan Aeron', 'Interim', '0.00', '18-02-2021', '08-03-2021', '05-03-2021', 0.0, 0.0], 'Mahickra Chemic': ['Mahickra Chemic', 'Interim', '2.00', '23-02-2021', '05-03-2021', '04-03-2021', 0.2, 0.0], 'Butterfly': ['Butterfly', 'Interim', '15.00', '12-02-2021', '03-03-2021', '02-03-2021', 1.5, 0.17761989342806395], 'Amara Raja Batt': ['Amara Raja Batt', 'Interim', '500.00', '15-02-2021', '26-02-2021', '25-02-2021', 5.0, 0.572737686139748], 'Career Point': ['Career Point', 'Interim', '10.00', '12-02-2021', '26-02-2021', '25-02-2021', 1.0, 0.6535947712418301], 'Dharamsi Morarj': ['Dharamsi Morarj', 'Interim', '10.00', '08-02-2021', '26-02-2021', '25-02-2021', 0.0, 0.0], 'GM': ['GM', 'Interim', '10.00', '16-02-2021', '26-02-2021', '25-02-2021', 0.0, 0.0], 'The Yamuna Synd': ['The Yamuna Synd', 'Interim', '175.00', '12-02-2021', '26-02-2021', '25-02-2021', 0.0, 0.0], 'Karda Construct': ['Karda Construct', 'Interim', '2.50', '15-02-2021', '25-02-2021', '24-02-2021', 0.04, 0.0], 'Nile': ['Nile', 'Interim', '10.00', '12-02-2021', '25-02-2021', '24-02-2021', 0.0, 0.0], 'RACL Geartech': ['RACL Geartech', 'Interim', '10.00', '15-02-2021', '25-02-2021', '24-02-2021', 0.0, 0.0], 'ISGEC Heavy Eng': ['ISGEC Heavy Eng', 'Interim', '200.00', '11-02-2021', '25-02-2021', '24-02-2021', 0.0, 0.0], 'Sandhar Technol': ['Sandhar Technol', 'Interim', '12.50', '15-02-2021', '25-02-2021', '24-02-2021', 1.2, 0.41841004184100417], 'Techno Electric': ['Techno Electric', 'Interim', '150.00', '15-02-2021', '25-02-2021', '24-02-2021', 3.0, 1.0101010101010102], 'Cochin Shipyard': ['Cochin Shipyard', 'Interim', '90.00', '04-01-2021', '14-01-2021', '13-01-2021', 9.0, 2.4128686327077746], 'Ircon Internati': ['Ircon Internati', 'Interim', '65.00', '09-02-2021', '24-02-2021', '23-02-2021', 1.3, 1.0526315789473684], 'Oil India': ['Oil India', 'Interim', '35.00', '11-02-2021', '24-02-2021', '23-02-2021', 3.5, 2.380952380952381], 'Precision Wires': ['Precision Wires', 'Interim', '40.00', '11-02-2021', '24-02-2021', '23-02-2021', 2.0, 1.1235955056179776], 'SJVN': ['SJVN', 'Interim', '18.00', '12-02-2021', '24-02-2021', '23-02-2021', 1.8, 4.0], 'United Drilling': ['United Drilling', 'Interim', '9.00', '15-02-2021', '24-02-2021', '23-02-2021', 0.9, 0.0], 'Zuari Global': ['Zuari Global', 'Interim', '10.00', '10-02-2021', '24-02-2021', '23-02-2021', 1.0, 1.1363636363636365], 'Aurobindo Pharm': ['Aurobindo Pharm', 'Interim', '150.00', '10-02-2021', '23-02-2021', '22-02-2021', 1.5, 0.11587485515643106], 'DCM Shriram Ind': ['DCM Shriram Ind', 'Interim', '50.00', '01-02-2021', '23-02-2021', '22-02-2021', 0.0, 0.0], 'Goldiam Inter': ['Goldiam Inter', 'Interim', '20.00', '11-02-2021', '23-02-2021', '22-02-2021', 2.0, 0.5813953488372093], 'ITC': ['ITC', 'Interim', '500.00', '11-02-2021', '23-02-2021', '22-02-2021', 5.0, 2.4154589371980677], 'Mazagon Dock': ['Mazagon Dock', 'Interim', '54.10', '01-02-2021', '23-02-2021', '22-02-2021', 5.4, 2.336448598130841], 'Mercury Labs': ['Mercury Labs', 'Interim', '15.00', '02-02-2021', '23-02-2021', '22-02-2021', 0.0, 0.0], 'NHPC': ['NHPC', 'Interim', '12.50', '11-02-2021', '23-02-2021', '22-02-2021', 1.2, 4.166666666666667], 'Natco Pharma': ['Natco Pharma', 'Interim', '50.00', '11-02-2021', '23-02-2021', '22-02-2021', 1.0, 0.12360939431396786], 'Panchsheel Org': ['Panchsheel Org', 'Interim', '15.00', '04-02-2021', '23-02-2021', '22-02-2021', 0.0, 0.0], 'Selan Explore': ['Selan Explore', 'Interim', '50.00', '10-02-2021', '23-02-2021', '22-02-2021', 5.0, 3.7313432835820897], 'Shanthi Gears': ['Shanthi Gears', 'Interim', '150.00', '10-02-2021', '23-02-2021', '22-02-2021', 1.5, 0.7352941176470589], 'Tube Investment': ['Tube Investment', 'Interim', '200.00', '11-02-2021', '23-02-2021', '22-02-2021', 2.0, 0.1834862385321101], 'Clariant Chem': ['Clariant Chem', 'Interim', '500.00', '09-02-2021', '22-02-2021', '18-02-2021', 50.0, 12.690355329949238], 'Centum Electron': ['Centum Electron', 'Interim', '20.00', '10-02-2021', '22-02-2021', '18-02-2021', 2.0, 0.4618937644341801], 'JB Chemicals': ['JB Chemicals', 'Interim', '425.00', '10-02-2021', '22-02-2021', '18-02-2021', 8.5, 0.6837606837606838], 'Mahanagar Gas': ['Mahanagar Gas', 'Interim', '90.00', '09-02-2021', '22-02-2021', '18-02-2021', 9.0, 0.760777683854607], 'Man Infra': ['Man Infra', 'Interim', '45.00', '10-02-2021', '22-02-2021', '18-02-2021', 0.9, 0.0], 'Seamec': ['Seamec', 'Final', '10.00', '10-02-2021', '22-02-2021', '18-02-2021', 1.0, 0.2053388090349076], 'Suprajit Eng': ['Suprajit Eng', 'Interim', '75.00', '10-02-2021', '22-02-2021', '18-02-2021', 0.75, 0.0], 'Vishal Fabrics': ['Vishal Fabrics', 'Interim', '10.00', '10-02-2021', '22-02-2021', '18-02-2021', 0.5, 0.0], 'Amrutanjan Heal': ['Amrutanjan Heal', 'Interim', '80.00', '03-02-2021', '19-02-2021', '17-02-2021', 0.8, 0.0], 'AVT Natural': ['AVT Natural', 'Interim', '30.00', '10-02-2021', '20-02-2021', '17-02-2021', 0.3, 0.0], 'BEML': ['BEML', 'Interim', '48.00', '04-02-2021', '19-02-2021', '17-02-2021', 4.8, 0.37243947858473], 'BPCL': ['BPCL', 'Interim', '160.00', '08-02-2021', '19-02-2021', '17-02-2021', 16.0, 3.5242290748898677], 'CAMS': ['CAMS', 'Interim', '76.00', '11-01-2021', '19-02-2021', '17-02-2021', 7.6, 0.38419319429198684], 'CARE Ratings': ['CARE Ratings', 'Interim', '30.00', '08-02-2021', '19-02-2021', '17-02-2021', 3.0, 0.6276150627615062], 'Esab India': ['Esab India', 'Interim', '190.00', '01-02-2021', '18-02-2021', '17-02-2021', 19.0, 1.0309278350515463], 'Everest Organic': ['Everest Organic', 'Interim', '5.00', '08-02-2021', '18-02-2021', '17-02-2021', 0.0, 0.0], 'Firstsource Sol': ['Firstsource Sol', 'Interim', '30.00', '09-02-2021', '19-02-2021', '17-02-2021', 3.0, 3.061224489795918], 'Garden Reach Sh': ['Garden Reach Sh', 'Interim', '38.50', '09-02-2021', '18-02-2021', '17-02-2021', 3.8, 1.5151515151515151], 'Hinduja Global': ['Hinduja Global', 'Interim', '60.00', '08-02-2021', '19-02-2021', '17-02-2021', 6.0, 0.5221932114882507], 'Akzo Nobel': ['Akzo Nobel', 'Interim', '200.00', '09-02-2021', '19-02-2021', '17-02-2021', 20.0, 0.9161704076958315], 'Indian Metals': ['Indian Metals', 'Interim', '30.00', '09-02-2021', '19-02-2021', '17-02-2021', 3.0, 0.6147540983606558], 'IRFC': ['IRFC', 'Interim', '10.50', '09-02-2021', '20-02-2021', '17-02-2021', 1.0, 4.166666666666667], 'Jamna Auto': ['Jamna Auto', 'Interim', '25.00', '05-02-2021', '18-02-2021', '17-02-2021', 0.25, 0.0], 'Kalpataru Power': ['Kalpataru Power', 'Interim', '425.00', '27-01-2021', '20-02-2021', '17-02-2021', 8.5, 2.0833333333333335], 'MOIL': ['MOIL', 'Interim', '25.00', '01-02-2021', '20-02-2021', '17-02-2021', 2.5, 1.3157894736842106], 'Metropolis': ['Metropolis', 'Interim', '400.00', '04-02-2021', '19-02-2021', '17-02-2021', 8.0, 0.40424456796361796], 'MRF': ['MRF', 'Interim', '30.00', '28-01-2021', '19-02-2021', '17-02-2021', 3.0, 0.0034560619326298326], 'NLC India': ['NLC India', 'Interim', '10.00', '04-02-2021', '19-02-2021', '17-02-2021', 1.0, 1.8867924528301887], 'ONGC': ['ONGC', 'Interim', '35.00', '15-02-2021', '20-02-2021', '17-02-2021', 1.75, 0.8620689655172413], 'Polyplex Corp': ['Polyplex Corp', 'Interim', '1000.00', '09-02-2021', '19-02-2021', '17-02-2021', 100.0, 12.787723785166241], 'Page Industries': ['Page Industries', 'Interim', '1500.00', '15-01-2021', '19-02-2021', '17-02-2021', 150.0, 0.5286529921759358], 'Rishiroop': ['Rishiroop', 'Interim', '50.00', '05-02-2021', '19-02-2021', '17-02-2021', 0.0, 0.0], 'Rashtriya Chem': ['Rashtriya Chem', 'Interim', '12.00', '05-02-2021', '19-02-2021', '17-02-2021', 1.2, 1.3157894736842106], 'Sandesh': ['Sandesh', 'Interim', '50.00', '09-02-2021', '19-02-2021', '17-02-2021', 5.0, 0.7299270072992701], 'Shivalik Bimeta': ['Shivalik Bimeta', 'Interim', '15.00', '04-02-2021', '19-02-2021', '17-02-2021', 0.0, 0.0], 'SVP Global': ['SVP Global', 'Interim', '5.00', '08-02-2021', '19-02-2021', '17-02-2021', 0.0, 0.0], 'Suven Pharma': ['Suven Pharma', 'Interim', '100.00', '03-02-2021', '18-02-2021', '17-02-2021', 1.0, 0.21052631578947367], 'Sun TV Network': ['Sun TV Network', 'Interim', '100.00', '08-02-2021', '19-02-2021', '17-02-2021', 5.0, 0.9920634920634921], 'Vidhi Spec': ['Vidhi Spec', 'Interim', '20.00', '03-02-2021', '19-02-2021', '17-02-2021', 0.2, 0.0], 'Acrysil India': ['Acrysil India', 'Interim', '40.00', '05-02-2021', '17-02-2021', '16-02-2021', 0.8, 0.0], 'Gulf Oil Lubric': ['Gulf Oil Lubric', 'Interim', '350.00', '05-02-2021', '17-02-2021', '16-02-2021', 7.0, 0.958904109589041], 'GPT Infra': ['GPT Infra', 'Interim', '15.00', '05-02-2021', '17-02-2021', '16-02-2021', 1.5, 2.380952380952381], 'Nilkamal': ['Nilkamal', 'Interim', '50.00', '09-02-2021', '17-02-2021', '16-02-2021', 5.0, 0.27114967462039047], 'Share India Sec': ['Share India Sec', 'Interim', '10.00', '08-02-2021', '17-02-2021', '16-02-2021', 1.0, 0.4424778761061947], 'TCI Express': ['TCI Express', 'Interim', '100.00', '25-01-2021', '17-02-2021', '16-02-2021', 2.0, 0.2178649237472767], 'Torrent Power': ['Torrent Power', 'Interim', '55.00', '01-02-2021', '17-02-2021', '16-02-2021', 5.5, 1.3157894736842106], 'Balkrishna Ind': ['Balkrishna Ind', 'Interim', '250.00', '01-02-2021', '16-02-2021', '15-02-2021', 5.0, 0.31645569620253167], 'Galaxy Surfacta': ['Galaxy Surfacta', 'Interim', '140.00', '03-02-2021', '16-02-2021', '15-02-2021', 14.0, 0.6378132118451025], 'Hikal': ['Hikal', 'Interim', '50.00', '04-02-2021', '16-02-2021', '15-02-2021', 1.0, 0.625], 'Hero Motocorp': ['Hero Motocorp', 'Special', '250.00', '06-02-2021', '16-02-2021', '15-02-2021', 5.0, 0.14979029358897544], 'Minda Corp': ['Minda Corp', 'Interim', '15.00', '03-02-2021', '16-02-2021', '15-02-2021', 0.3, 0.0], 'Minda Ind': ['Minda Ind', 'Interim', '17.50', '04-02-2021', '16-02-2021', '15-02-2021', 0.34, 0.0], 'Praveg': ['Praveg', 'Interim', '20.00', '01-02-2021', '16-02-2021', '15-02-2021', 0.0, 0.0], 'Torrent Pharma': ['Torrent Pharma', 'Interim', '400.00', '18-01-2021', '16-02-2021', '15-02-2021', 20.0, 0.8163265306122449], 'Alkyl Amines': ['Alkyl Amines', 'Interim', '200.00', '02-02-2021', '15-02-2021', '12-02-2021', 10.0, 0.196347928529354], 'Cantabil Retail': ['Cantabil Retail', 'Interim', '10.00', '02-02-2021', '15-02-2021', '12-02-2021', 1.0, 0.25906735751295334], 'Saurashtra Cem': ['Saurashtra Cem', 'Interim', '10.00', '02-02-2021', '15-02-2021', '12-02-2021', 0.0, 0.0], 'Apcotex Ind': ['Apcotex Ind', 'Interim', '75.00', '28-01-2021', '12-02-2021', '11-02-2021', 1.5, 0.5649717514124294], 'Alkem Lab': ['Alkem Lab', 'Interim', '1250.00', '27-01-2021', '13-02-2021', '11-02-2021', 25.0, 0.9022013713460845], 'Bajaj Consumer': ['Bajaj Consumer', 'Interim', '600.00', '03-02-2021', '13-02-2021', '11-02-2021', 6.0, 2.42914979757085], 'Balrampur Chini': ['Balrampur Chini', 'Interim', '250.00', '02-02-2021', '12-02-2021', '11-02-2021', 2.5, 1.1428571428571428], 'BLS Internation': ['BLS Internation', 'Interim', '25.00', '02-02-2021', '12-02-2021', '11-02-2021', 0.25, 0.0], 'Control Print': ['Control Print', 'Interim', '40.00', '02-02-2021', '12-02-2021', '11-02-2021', 4.0, 1.7391304347826086], 'Carborundum': ['Carborundum', 'Interim', '150.00', '02-02-2021', '12-02-2021', '11-02-2021', 1.5, 0.19801980198019803], 'Dhampur Sugar': ['Dhampur Sugar', 'Interim', '60.00', '25-01-2021', '12-02-2021', '11-02-2021', 6.0, 3.508771929824561], 'Equitas Holding': ['Equitas Holding', 'Interim', '20.00', '02-02-2021', '13-02-2021', '11-02-2021', 2.0, 2.272727272727273], 'HIL': ['HIL', 'Interim', '150.00', '02-02-2021', '12-02-2021', '11-02-2021', 15.0, 0.5136986301369864], 'Indo Amines': ['Indo Amines', 'Interim', '5.00', '20-01-2021', '13-02-2021', '11-02-2021', 0.0, 0.0], 'IWML': ['IWML', 'Interim', '1500.00', '02-02-2021', '12-02-2021', '11-02-2021', 30.0, 2.5641025641025643], 'Gillette India': ['Gillette India', 'Interim', '330.00', '28-01-2021', '12-02-2021', '11-02-2021', 33.0, 0.5935251798561151], 'Modison Metals': ['Modison Metals', 'Interim', '150.00', '03-02-2021', '13-02-2021', '11-02-2021', 0.0, 0.0], 'NTPC': ['NTPC', 'Interim', '30.00', '27-01-2021', '12-02-2021', '11-02-2021', 3.0, 2.7777777777777777], 'PI Industries': ['PI Industries', 'Interim', '300.00', '03-02-2021', '12-02-2021', '11-02-2021', 3.0, 0.1349527665317139], 'PNB Gilts': ['PNB Gilts', 'Interim', '40.00', '28-01-2021', '12-02-2021', '11-02-2021', 4.0, 7.6923076923076925], 'Coromandel Int': ['Coromandel Int', 'Interim', '600.00', '01-02-2021', '11-02-2021', '10-02-2021', 6.0, 0.78125], 'KPR Mill': ['KPR Mill', 'Interim', '75.00', '29-01-2021', '11-02-2021', '10-02-2021', 3.75, 0.3232758620689655], 'Manappuram Fin': ['Manappuram Fin', 'Interim', '32.50', '29-01-2021', '11-02-2021', '10-02-2021', 0.64, 0.0], 'P and G': ['P and G', 'Interim', '850.00', '28-01-2021', '11-02-2021', '10-02-2021', 85.0, 0.6538461538461539], 'Subex': ['Subex', 'Interim', '10.00', '01-02-2021', '11-02-2021', '10-02-2021', 0.5, 0.0], 'Transport Corp': ['Transport Corp', 'Interim', '60.00', '21-01-2021', '11-02-2021', '10-02-2021', 1.2, 0.40160642570281124], 'Cummins': ['Cummins', 'Interim', '350.00', '28-01-2021', '10-02-2021', '09-02-2021', 7.0, 0.8871989860583016], 'Cholamandalam': ['Cholamandalam', 'Interim', '65.00', '29-01-2021', '10-02-2021', '09-02-2021', 1.3, 0.19646365422396855], 'Dr Lal PathLab': ['Dr Lal PathLab', 'Interim', '60.00', '29-01-2021', '10-02-2021', '09-02-2021', 6.0, 0.2646669607410675], 'V R Films': ['V R Films', 'Interim', '10.00', '22-01-2021', '10-02-2021', '09-02-2021', 0.0, 0.0], 'IOC': ['IOC', 'Interim', '75.00', '29-01-2021', '10-02-2021', '09-02-2021', 7.5, 7.0], 'LT Foods': ['LT Foods', 'Interim', '50.00', '20-01-2021', '10-02-2021', '09-02-2021', 0.5, 0.0], 'Orient Electric': ['Orient Electric', 'Interim', '75.00', '29-01-2021', '10-02-2021', '09-02-2021', 0.75, 0.0], 'Persistent': ['Persistent', 'Interim', '140.00', '19-01-2021', '10-02-2021', '09-02-2021', 14.0, 0.8449004224502112], 'Sun Pharma': ['Sun Pharma', 'Interim', '550.00', '29-01-2021', '10-02-2021', '09-02-2021', 5.5, 0.8116883116883117], 'Bharat Elec': ['Bharat Elec', 'Interim', '140.00', '28-01-2021', '09-02-2021', '08-02-2021', 1.4, 0.7194244604316546], 'INDUS TOWERS': ['INDUS TOWERS', 'Interim', '178.20', '28-01-2021', '09-02-2021', '08-02-2021', 17.8, 6.415094339622642], 'Granules India': ['Granules India', 'Interim', '25.00', '28-01-2021', '09-02-2021', '08-02-2021', 0.25, 0.0], 'Gravita India': ['Gravita India', 'Interim', '55.00', '28-01-2021', '09-02-2021', '08-02-2021', 1.1, 1.1111111111111112], 'Laurus Labs': ['Laurus Labs', 'Interim', '20.00', '28-01-2021', '09-02-2021', '08-02-2021', 0.4, 0.0], 'Motilal Oswal': ['Motilal Oswal', 'Interim', '500.00', '28-01-2021', '09-02-2021', '08-02-2021', 5.0, 0.8210180623973727], 'Orient Cement': ['Orient Cement', 'Interim', '50.00', '28-01-2021', '09-02-2021', '08-02-2021', 0.5, 0.0], 'Visaka Ind': ['Visaka Ind', 'Interim', '50.00', '28-01-2021', '09-02-2021', '08-02-2021', 5.0, 0.9671179883945842], 'Cosmo Films': ['Cosmo Films', 'Interim', '250.00', '27-01-2021', '08-02-2021', '05-02-2021', 25.0, 4.921259842519685], 'Accelya Kale': ['Accelya Kale', 'Interim', '350.00', '29-01-2021', '08-02-2021', '05-02-2021', 35.0, 3.8932146829810903], 'Nippon': ['Nippon', 'Interim', '30.00', '27-01-2021', '08-02-2021', '05-02-2021', 3.0, 0.8955223880597015], 'A.K.Capital Ser': ['A.K.Capital Ser', 'Interim', '50.00', '27-01-2021', '06-02-2021', '04-02-2021', 0.0, 0.0], 'Emami': ['Emami', 'Interim', '400.00', '18-01-2021', '05-02-2021', '04-02-2021', 4.0, 0.8714596949891068], 'Exide Ind': ['Exide Ind', 'Interim', '200.00', '12-01-2021', '06-02-2021', '04-02-2021', 2.0, 0.9852216748768473], 'Godawari Power': ['Godawari Power', 'Interim', '50.00', '25-01-2021', '06-02-2021', '04-02-2021', 5.0, 0.8532423208191127], 'IIFL Finance': ['IIFL Finance', 'Interim', '150.00', '21-01-2021', '06-02-2021', '04-02-2021', 3.0, 1.098901098901099], 'SAIL': ['SAIL', 'Interim', '10.00', '25-01-2021', '06-02-2021', '04-02-2021', 1.0, 1.36986301369863], 'Sundaram-Clayto': ['Sundaram-Clayto', 'Interim', '300.00', '18-01-2021', '06-02-2021', '04-02-2021', 15.0, 0.4271070615034169], 'TVS Motor': ['TVS Motor', 'Interim', '210.00', '18-01-2021', '05-02-2021', '04-02-2021', 2.1, 0.3401360544217687], 'Vaibhav Global': ['Vaibhav Global', 'Interim', '75.00', '15-01-2021', '06-02-2021', '04-02-2021', 7.5, 0.20497803806734993], 'Bella Casa': ['Bella Casa', 'Interim', '6.00', '19-01-2021', '04-02-2021', '03-02-2021', 0.0, 0.0], 'Kewal Kiran': ['Kewal Kiran', 'Interim', '80.00', '22-01-2021', '04-02-2021', '03-02-2021', 8.0, 0.8888888888888888], 'Menon Bearings': ['Menon Bearings', 'Interim', '150.00', '08-01-2021', '04-02-2021', '03-02-2021', 1.5, 1.7543859649122806], 'Wendt': ['Wendt', 'Final', '100.00', '22-01-2021', '04-02-2021', '03-02-2021', 10.0, 0.30413625304136255], 'Kajaria Ceramic': ['Kajaria Ceramic', 'Interim', '1000.00', '21-01-2021', '03-02-2021', '02-02-2021', 10.0, 1.0683760683760684], 'KSolves': ['KSolves', 'Interim', '100.00', '20-01-2021', '03-02-2021', '02-02-2021', 10.0, 1.594896331738437], 'Sagar Cement': ['Sagar Cement', 'Interim', '20.00', '20-01-2021', '03-02-2021', '02-02-2021', 2.0, 0.2898550724637681], 'Sundaram Fin': ['Sundaram Fin', 'Interim', '120.00', '20-01-2021', '03-02-2021', '02-02-2021', 12.0, 0.48582995951417], 'Phillips Carbon': ['Phillips Carbon', 'Interim', '350.00', '20-01-2021', '02-02-2021', '01-02-2021', 7.0, 3.5175879396984926], 'Symphony': ['Symphony', 'Interim', '50.00', '19-01-2021', '02-02-2021', '01-02-2021', 1.0, 0.08795074758135445], 'Zensar Tech': ['Zensar Tech', 'Interim', '60.00', '31-12-2020', '01-02-2021', '29-01-2021', 1.2, 0.32894736842105265], 'SRF': ['SRF', 'Interim', '190.00', '11-01-2021', '01-02-2021', '29-01-2021', 19.0, 0.35434539350988437], 'GMM Pfaudler': ['GMM Pfaudler', 'Interim', '50.00', '11-01-2021', '29-01-2021', '28-01-2021', 1.0, 0.02426595486532395], 'Havells India': ['Havells India', 'Interim', '300.00', '11-01-2021', '29-01-2021', '28-01-2021', 3.0, 0.2561912894961571], 'IEX': ['IEX', 'Interim', '250.00', '15-01-2021', '30-01-2021', '28-01-2021', 2.5, 0.6734006734006734], 'DCM Shriram': ['DCM Shriram', 'Interim', '275.00', '11-01-2021', '28-01-2021', '27-01-2021', 5.5, 1.0893246187363834], 'GAIL': ['GAIL', 'Interim', '25.00', '15-01-2021', '28-01-2021', '27-01-2021', 2.5, 1.3605442176870748], 'Siemens': ['Siemens', 'Final', '350.00', '25-11-2020', '-', '27-01-2021', 7.0, 0.3663003663003663], 'CESC': ['CESC', 'Interim', '450.00', '13-01-2021', '25-01-2021', '22-01-2021', 45.0, 7.425742574257426], 'Wipro': ['Wipro', 'Interim', '50.00', '13-01-2021', '25-01-2021', '22-01-2021', 1.0, 0.24096385542168675], 'HCL Tech': ['HCL Tech', 'Interim', '200.00', '15-01-2021', '23-01-2021', '21-01-2021', 4.0, 0.437636761487965], 'TAAL Enterprise': ['TAAL Enterprise', 'Interim', '200.00', '12-01-2021', '23-01-2021', '21-01-2021', 0.0, 0.0], 'TCS': ['TCS', 'Interim', '600.00', '31-12-2020', '16-01-2021', '14-01-2021', 6.0, 0.2037351443123939], 'Refex Ind': ['Refex Ind', 'Interim', '10.00', '29-12-2020', '12-01-2021', '11-01-2021', 1.0, 1.1235955056179776], 'RITES': ['RITES', 'Interim', '50.00', '30-12-2020', '11-01-2021', '08-01-2021', 5.0, 2.05761316872428], 'Gateway Distri': ['Gateway Distri', 'Interim', '20.00', '29-12-2020', '06-01-2021', '05-01-2021', 2.0, 1.1299435028248588], 'new_data': ['Nestle', 'Final', '650.00', '16-02-2021', '-', '29-04-2021', 65.0, 0.40385212799005904]}


def home(request):
#     if('output' not in request.session.keys()):
#         data = {}
#         data= dividend()
#         request.session['output'] = data
#     else:
#         data = request.session.get('output')
    return render(request,'Home.html',{'Data':data})


#Data extraction
def dividend():
    html_tables = pd.read_html("https://www.moneycontrol.com/stocks/marketinfo/dividends_declared/index.php?sel_year=2021")
    df = html_tables[1]
    data = {}
    #company names
    key = df.T.values[0]
    #compny urls
    links = urls()
    count = 0
    for i in range(2,len(key)):
        l = []
        for j in range(len(df.T.values)):
            l.append(df.T.values[j][i])
        #if dividend is 0 than Dividend % FV and Dividend % MP is 0
        if(l[2] == '0.0'):
            l.append(0.0)
            l.append(0.0)
        else:
            try:
                dt = current_value('https://www.moneycontrol.com/india/stockpricequote'+links[i-2])
                c_v = dt.contents[1]['rel']
                f_v = dt.contents[0]
            except:
                c_v = 1
                f_v = 0
            l.append(d_fv(int(float(l[2])),int(float(f_v))))
            l.append(d_mp(int(float(c_v)),int(l[6])))

        data[key[i]] = l
    return data

#to fetch urls of every company
def urls():
    req = Request("https://www.moneycontrol.com/stocks/marketinfo/dividends_declared/index.php?sel_year=2021")
    html_page = urlopen(req)
    soup = BeautifulSoup(html_page, "lxml")
    table = soup.find('table', 'b_12 dvdtbl')
    links = []
    for link in table.findAll('a'):
        links.append(link.get('href'))
    return links


#to extract current stock price and face value
def current_value(url):
    content = requests.get(url).text
    soup = BeautifulSoup(content, "html.parser")
    cv = soup.find('div', class_='inprice1 nsecp')
    fv = soup.find('td', class_='nsefv bsefv')
    fv.append(cv)
    return (fv)

#calculation of Dividend % (FV)
def d_fv(dv,fv):
    return (dv*fv)/100

#calculation of Dividend % (MP)
def d_mp(c_v,d_fv):
    return (d_fv*100)/c_v
